#include <stdio.h>
#include <stdbool.h>

int main(void) {
    const double เติมสิทธิ์ต่อวัน = 150.0;
    const double วงเงินรวมโครงการ = 3000.0;

    int จำนวนบิล;
    double สิทธิ์สะสม = 0.0, เงินคืนรวม = 0.0, ราคารวม = 0.0, จ่ายรวม = 0.0, กระเป๋าเงิน = 0.0;

    // ---------- 1) รับ "วันเริ่มโครงการ" ----------
    int วันเริ่ม, เดือนเริ่ม, ปีเริ่ม;
    printf("ระบุวันเริ่มโครงการ (DD MM YYYY): ");
    scanf("%d %d %d", &วันเริ่ม, &เดือนเริ่ม, &ปีเริ่ม);
    int วันเริ่ม_key = วันเริ่ม*1000000 + เดือนเริ่ม*10000 + ปีเริ่ม;

    // สถานะวันล่าสุด = วันเริ่มโครงการ และเติมสิทธิ์ของ "วันแรก" ให้เลย
    int วันล่าสุด_key = วันเริ่ม_key;
    bool โครงการเริ่มแล้ว = true;
    สิทธิ์สะสม += เติมสิทธิ์ต่อวัน;

    // ---------- รับจำนวนบิล ----------
    printf("ใส่จำนวนบิลทั้งหมด: ");
    scanf("%d", &จำนวนบิล);

    for (int i = 1; i <= จำนวนบิล; i++) {
        int วัน, เดือน, ปี, ร้านร่วม;
        double ราคา;
        char ชื่อสินค้า[100];

        printf("\n=== รายการที่ %d ===\n", i);
        printf("วันที่ (DD MM YYYY): ");
        scanf("%d %d %d", &วัน, &เดือน, &ปี);

        printf("ชื่อสินค้า: ");
        scanf(" %99[^\n]", ชื่อสินค้า);

        printf("ราคาสินค้า (บาท): ");
        scanf("%lf", &ราคา);

        printf("ร้านร่วมโครงการไหม (1=ใช่, 0=ไม่ใช่): ");
        scanf("%d", &ร้านร่วม);

        // แปลงวันที่เป็น key ง่าย ๆ
        int วันนี้_key = วัน*1000000 + เดือน*10000 + ปี;

        // ---------- 2) เติมสิทธิ์หาก "ข้ามวัน" นับตั้งแต่วันล่าสุด ----------
        if (วันนี้_key < วันเริ่ม_key) {
            // ถ้าข้อมูลย้อนหลังก่อนวันเริ่ม → ไม่คิดสิทธิ์ (ข้ามหรือแจ้งเตือนก็ได้)
            printf("** ข้อมูลก่อนวันเริ่มโครงการ: ไม่คิดสิทธิ์การคืน **\n");
        } else if (วันนี้_key > วันล่าสุด_key) {
            int จำนวนวันที่ข้าม = วันนี้_key - วันล่าสุด_key;
            สิทธิ์สะสม += เติมสิทธิ์ต่อวัน * (double)จำนวนวันที่ข้าม;
            วันล่าสุด_key = วันนี้_key;
        }

        // คืนเงินทันที 50% (จำกัดด้วยสิทธิ์สะสม + วงเงินรวมโครงการ)
        double ต้องการคืน = (ร้านร่วม == 1) ? 0.5 * ราคา : 0.0;
        double เหลือโครงการ = วงเงินรวมโครงการ - เงินคืนรวม;
        if (เหลือโครงการ < 0) เหลือโครงการ = 0;

        double ได้คืน = ต้องการคืน;
        if (ได้คืน > สิทธิ์สะสม) ได้คืน = สิทธิ์สะสม;
        if (ได้คืน > เหลือโครงการ) ได้คืน = เหลือโครงการ;

        double จ่ายจริง = ราคา - ได้คืน;

        // อัปเดตยอดรวมแบบคำง่าย
        สิทธิ์สะสม = สิทธิ์สะสม - ได้คืน;   // หักสิทธิ์ที่ใช้ไป
        เงินคืนรวม = เงินคืนรวม + ได้คืน;   // รวมเงินคืนที่รัฐช่วยทั้งหมด
        ราคารวม   = ราคารวม   + ราคา;       // รวมราคาสินค้าทั้งหมด
        จ่ายรวม   = จ่ายรวม   + จ่ายจริง;    // รวมยอดที่ผู้ใช้จ่ายจริง
        กระเป๋าเงิน = กระเป๋าเงิน + ได้คืน;  // เงินคืนเข้า “กระเป๋า” ทันที

        // แสดงผล
        const char* สถานะ = (เงินคืนรวม >= วงเงินรวมโครงการ - 1e-9) ? "หมดโครงการ" : "ปกติ";
        printf("สินค้า: %s | ราคา: %.2f | คืน: %.2f | จ่ายจริง: %.2f | สิทธิ์คงเหลือ: %.2f | %s\n",
               ชื่อสินค้า, ราคา, ได้คืน, จ่ายจริง, สิทธิ์สะสม, สถานะ);
    }

    // สรุปท้าย
    printf("\n===== สรุปทั้งหมด =====\n");
    printf("รวมราคาสินค้า: %.2f\n", ราคารวม);
    printf("รวมคืนทั้งหมด: %.2f (ลิมิตโครงการ %.2f)\n", เงินคืนรวม, วงเงินรวมโครงการ);
    printf("รวมจ่ายจริง: %.2f\n", จ่ายรวม);
    printf("สิทธิ์คงเหลือ: %.2f\n", สิทธิ์สะสม);
    printf("เงินในกระเป๋า: %.2f\n", กระเป๋าเงิน);
    printf("=======================\n");

    return 0;
}
