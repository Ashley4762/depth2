#include <stdio.h>
#include <stdbool.h>

/* แปลงวันที่เป็นจำนวนวันนับจากจุดอ้างอิง (รองรับปีอธิกสุรทิน) */
static long long days_from_civil(int y, int m, int d) {
    y -= m <= 2;
    int era = (y >= 0 ? y : y-399) / 400;
    unsigned yoe = (unsigned)(y - era*400);
    unsigned doy = (153*(m + (m > 2 ? -3 : 9)) + 2)/5 + d - 1;
    unsigned doe = yoe*365 + yoe/4 - yoe/100 + doy;
    return (long long)era*146097 + (long long)doe - 719468; // อิง 1970-01-01
}

int main(void) {
    /* ค่าคงที่ */
    const double เติมสิทธิ์ต่อวัน = 150.0;  // เติมเข้าพูลทุกวัน (ทบได้)

    /* สรุปรวม */
    int จำนวนบิล;
    double กระเป๋าเงิน = 0.0;     // เงินคืนสะสม (โอนเข้าทันที)
    double ราคารวม   = 0.0;
    double เงินคืนรวม = 0.0;
    double จ่ายรวม   = 0.0;

    /* สิทธิ์สะสมแบบทบ */
    double สิทธิ์สะสม = 0.0;       // พูลสิทธิ์ที่ใช้คืนได้ (ทบได้หลายวัน)
    long long วันก่อนหน้า = 0;     // ใช้เช็กว่าข้ามวันหรือยัง
    bool เริ่มต้นแล้ว = false;

    printf("ใส่จำนวนบิลที่จะบันทึก: ");
    if (scanf("%d", &จำนวนบิล) != 1 || จำนวนบิล <= 0) {
        printf("จำนวนบิลต้องมากกว่า 0\n");
        return 0;
    }

    for (int i = 1; i <= จำนวนบิล; i++) {
        int ปี, เดือน, วัน;
        char ชื่อสินค้า[128];
        double ราคา;
        int ร้านร่วม;  // 1=ใช่, 0=ไม่ใช่

        printf("\n=== บิลที่ %d ===\n", i);

        /* รับวัน (ใช้สำหรับทบสิทธิ์ข้ามวัน) */
        printf("วันที่ (YYYY MM DD): ");
        scanf("%d %d %d", &ปี, &เดือน, &วัน);

        /* อ่านชื่อสินค้าที่มีช่องว่างได้ */
        printf("ชื่อสินค้า: ");
        scanf(" %127[^\n]", ชื่อสินค้า);

        printf("ราคาสินค้า (บาท): ");
        scanf("%lf", &ราคา);

        printf("ร้านร่วมโครงการไหม (1=ใช่, 0=ไม่ใช่): ");
        scanf("%d", &ร้านร่วม);

        /* อัปเดตสิทธิ์สะสมเมื่อเข้าวันใหม่ (นับข้าม "เที่ยงคืน") */
        long long วันนี้ = days_from_civil(ปี, เดือน, วัน);
        if (!เริ่มต้นแล้ว) {
            เริ่มต้นแล้ว = true;
            วันก่อนหน้า = วันนี้;
            สิทธิ์สะสม += เติมสิทธิ์ต่อวัน;            // เติมของวันแรก
        } else if (วันนี้ > วันก่อนหน้า) {
            long long จำนวนวันที่ข้าม = วันนี้ - วันก่อนหน้า;
            สิทธิ์สะสม += เติมสิทธิ์ต่อวัน * (double)จำนวนวันที่ข้าม;
            วันก่อนหน้า = วันนี้;
        }

        /* คำนวณคืนเงินทันที 50% (เฉพาะร้านร่วม) โดยไม่เกินสิทธิ์สะสม */
        double ต้องการคืน = (ร้านร่วม == 1) ? 0.5 * ราคา : 0.0;
        double ได้คืน = ต้องการคืน;
        if (ได้คืน > สิทธิ์สะสม) ได้คืน = สิทธิ์สะสม;

        double จ่ายจริง = ราคา - ได้คืน;

        /* อัปเดตยอดรวม */
        ราคารวม   += ราคา;
        เงินคืนรวม += ได้คืน;
        จ่ายรวม   += จ่ายจริง;
        กระเป๋าเงิน += ได้คืน;
        สิทธิ์สะสม -= ได้คืน;

        /* แสดงผลบิลนี้ (คำง่าย) */
        printf("วัน: %04d-%02d-%02d | สินค้า: %s\n", ปี, เดือน, วัน, ชื่อสินค้า);
        printf("ราคา: %.2f | ร้านร่วม: %s | ขอคืน: %.2f | ได้คืน: %.2f | จ่ายจริง: %.2f\n",
               ราคา, (ร้านร่วม ? "ใช่" : "ไม่ใช่"),
               ต้องการคืน, ได้คืน, จ่ายจริง);
        printf("สิทธิ์คงเหลือ: %.2f | กระเป๋า: %.2f\n", สิทธิ์สะสม, กระเป๋าเงิน);
    }

    /* สรุปท้าย */
    printf("\n==== สรุปทั้งหมด ====\n");
    printf("รวมราคาสินค้า : %.2f บาท\n", ราคารวม);
    printf("รวมเงินคืน     : %.2f บาท\n", เงินคืนรวม);
    printf("รวมที่จ่ายจริง : %.2f บาท\n", จ่ายรวม);
    printf("เงินในกระเป๋า  : %.2f บาท\n", กระเป๋าเงิน);
    printf("สิทธิ์คงเหลือ  : %.2f บาท\n", สิทธิ์สะสม);
    printf("=====================\n");

    return 0;
